<div class="max-w-2xl mx-auto">
  <% if @posts.any? %>
    <% @posts.each do |post| %>
      <% cache ["post_card", post, post.user, current_user&.id] do %>
        <div class="max-w-md mx-auto bg-white dark:bg-gray-900 rounded-lg shadow-md overflow-hidden my-6 border border-gray-200 dark:border-gray-700">

          <!-- Header: avatar, user info, options button -->
          <div class="flex items-center px-4 py-3 space-x-3">
            <%= link_to profile_path(post.user), class: "flex items-center space-x-3" do %>
              <% if post.user.avatar.attached? %>
                <%= image_tag post.user.avatar.variant(resize_to_fill: [40, 40]), 
                    alt: "#{post.user.username}'s avatar", 
                    class: "h-10 w-10 rounded-full object-cover border-2 border-gray-200", 
                    loading: "lazy" %>
              <% else %>
                <!-- Default avatar if no image -->
                <div class="h-10 w-10 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center">
                  <span class="text-gray-600 dark:text-gray-300 font-medium">
                    <%= post.user.username.first.upcase %>
                  </span>
                </div>
              <% end %>
            <% end %>

            <div class="flex-1">
              <%= link_to profile_path(post.user) do %>
                <p class="text-sm font-semibold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                  <%= post.user.username %>
                </p>
              <% end %>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                <%= time_ago_in_words(post.created_at) %> ago
              </p>
            </div>

            <%= render partial: "users/post_buttons", locals: { post: post } %>
          </div>

          <!-- Post image -->
          <div class="relative">
            <% if post.image.attached? %>
              <%= image_tag post.image.variant(resize_to_limit: [800, 500]), 
                  alt: "Post by #{post.user.username}", 
                  class: "w-full object-cover max-h-[500px]", 
                  loading: "lazy" %>
            <% else %>
              <p class="text-center text-gray-400 py-6">No image available</p>
            <% end %>
          </div>

          <!-- Actions: like, comment, share -->
          <div class="flex items-center px-4 py-3 space-x-4 text-gray-700 dark:text-gray-300">
            <button class="focus:outline-none hover:text-red-500 transition-colors duration-150">
              <!-- Heart (like) icon -->
              <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20.8 4.6c-1.4-1.5-3.7-1.5-5.1 0L12 8.3l-3.7-3.7c-1.4-1.5-3.7-1.5-5.1 0-1.5 1.4-1.5 3.7 0 5.1l3.7 3.7L12 21l5.1-5.1 3.7-3.7c1.5-1.4 1.5-3.7 0-5.1z"/>
              </svg>
            </button>

            <button class="focus:outline-none hover:text-blue-500 transition-colors duration-150">
              <!-- Comment icon -->
              <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
            </button>

            <button class="focus:outline-none hover:text-green-500 transition-colors duration-150 ml-auto">
              <!-- Share icon -->
              <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
            </button>
          </div>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-500 dark:text-gray-400 text-lg">No posts yet!</p>
      <%= link_to "Create your first post", new_post_path, 
          class: "mt-4 inline-block bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors" %>
    </div>
  <% end %>
</div>
